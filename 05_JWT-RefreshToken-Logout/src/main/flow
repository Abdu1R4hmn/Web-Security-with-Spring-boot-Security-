
Request
↓
Authentication Filter (e.g. BasicAuthenticationFilter)
↓
ExceptionTranslationFilter
↓
Authorization Filter
↓
DispatcherServlet (aka: Controller)
↓
DTO Validation
↓
Controller
↓
Service
↓
(400 / 404 / 500 handled here)
↓
HTTP Response

````````````````````````````````````````````````````````````````

Authentication Filter (e.g. BasicAuthenticationFilter)
↓
Create unauthenticated Authentication
↓
AuthenticationManager
↓
ProviderManager
↓
DaoAuthenticationProvider
↓
UserDetailsService + PasswordEncoder
↓
Create NEW authenticated Authentication
↓
SecurityContextHolder

````````````````````````````````````````````````````````````````

ExceptionTranslationFilter
↓
Waits for exceptions from:
  - Authentication Filter
  - Authorization Filter
↓
IF AuthenticationException:
    → Clear SecurityContext
    → Call AuthenticationEntryPoint
    → Send 401 response
↓
ELSE IF AccessDeniedException:
    → Check SecurityContext
        IF not authenticated:
            → AuthenticationEntryPoint (401)
        ELSE:
            → AccessDeniedHandler (403)
↓
STOP filter chain


````````````````````````````````````````````````````````````````

Authorization Filter
↓
Read Authentication from SecurityContextHolder
↓
Is Authentication present?
    ❌ NO → throw AuthenticationException
    ✔ YES → continue
↓
Check authorities vs rules:
    - hasRole()
    - hasAuthority()
    - @PreAuthorize
    - antMatchers()
↓
IF insufficient privileges:
    → throw AccessDeniedException
↓
IF allowed:
    → Continue to controller


